<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hedera Token Manager</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .wallet-status {
            display: inline-block;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            margin-top: 15px;
            font-size: 14px;
        }
        
        .main-content {
            padding: 40px;
        }
        
        .connect-section {
            text-align: center;
            padding: 60px 20px;
        }
        
        .connect-btn {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
        }
        
        .connect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(79, 70, 229, 0.4);
        }
        
        .tabs {
            display: flex;
            border-bottom: 2px solid #e5e7eb;
            margin-bottom: 30px;
            overflow-x: auto;
        }
        
        .tab {
            padding: 15px 25px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            color: #6b7280;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .tab.active {
            color: #4f46e5;
            border-bottom: 3px solid #4f46e5;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }
        
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .btn-danger:hover {
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        
        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }
        
        .status-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        
        .status-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
        
        .status-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .token-list {
            background: #f9fafb;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .token-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid #e5e7eb;
            transition: all 0.3s ease;
        }
        
        .token-item:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .token-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .token-name {
            font-weight: 600;
            color: #111827;
        }
        
        .token-address {
            font-family: monospace;
            font-size: 14px;
            color: #6b7280;
        }
        
        .advanced-section {
            background: #f8fafc;
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
        }
        
        .advanced-section h3 {
            color: #374151;
            margin-bottom: 20px;
            font-size: 1.2rem;
        }
        
        .token-management {
            background: #f8fafc;
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
        }
        
        .saved-tokens-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .saved-token-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s ease;
        }
        
        .saved-token-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .token-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .token-action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .token-action-btn.primary {
            background: #4f46e5;
            color: white;
        }
        
        .token-action-btn.secondary {
            background: #6b7280;
            color: white;
        }
        
        .token-action-btn.danger {
            background: #ef4444;
            color: white;
        }
        
        .no-tokens {
            text-align: center;
            color: #6b7280;
            padding: 40px;
        }
        
        .management-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .refresh-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .saved-tokens-grid {
                grid-template-columns: 1fr;
            }
            
            .management-header {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🌟 Hedera Token Manager</h1>
            <p>Create, manage, and interact with your Hedera EVM tokens</p>
            <div id="walletStatus" class="wallet-status">
                Not Connected
            </div>
        </div>
        
        <div class="main-content">
            <div id="connectSection" class="connect-section">
                <h2>Connect Your Wallet</h2>
                <p style="margin: 20px 0; color: #6b7280;">Connect your MetaMask wallet to start managing tokens on Hedera</p>
                <button id="connectWallet" class="connect-btn">
                    Connect MetaMask
                </button>
            </div>
            
            <div id="mainApp" style="display: none;">
                <div class="tabs">
                    <button class="tab active" onclick="showTab('deploy', this)">Deploy Token</button>
                    <button class="tab" onclick="showTab('mint', this)">Mint Tokens</button>
                    <button class="tab" onclick="showTab('roles', this)">Manage Roles</button>
                    <button class="tab" onclick="showTab('metadata', this)">Set Metadata</button>
                    <button class="tab" onclick="showTab('transfer', this)">Transfer</button>
                    <button class="tab" onclick="showTab('existing', this)">Existing Tokens</button>
                    <button class="tab" onclick="showTab('manage', this)">Manage Tokens</button>
                </div>
                
                <!-- Deploy Token Tab -->
                <div id="deployTab" class="tab-content active">
                    <h2>Deploy New Token</h2>
                    <form id="deployForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="tokenName">Token Name</label>
                                <input type="text" id="tokenName" placeholder="e.g., My Awesome Token" required>
                            </div>
                            <div class="form-group">
                                <label for="tokenSymbol">Token Symbol</label>
                                <input type="text" id="tokenSymbol" placeholder="e.g., MAT" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="initialMint">Initial Mint Amount (optional)</label>
                            <input type="number" id="initialMint" placeholder="0" min="0">
                        </div>
                        <button type="submit" class="btn" id="deployBtn">
                            Deploy Token
                        </button>
                    </form>
                </div>
                
                <!-- Mint Tokens Tab -->
                <div id="mintTab" class="tab-content">
                    <h2>Mint Tokens</h2>
                    <form id="mintForm">
                        <div class="form-group">
                            <label for="mintTokenAddress">Token Contract Address</label>
                            <input type="text" id="mintTokenAddress" placeholder="0x..." required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="mintRecipient">Recipient Address</label>
                                <input type="text" id="mintRecipient" placeholder="0x..." required>
                            </div>
                            <div class="form-group">
                                <label for="mintAmount">Amount</label>
                                <input type="number" id="mintAmount" placeholder="100" min="0" step="0.000001" required>
                            </div>
                        </div>
                        <button type="submit" class="btn" id="mintBtn">
                            Mint Tokens
                        </button>
                    </form>
                </div>
                
                <!-- Roles Tab -->
                <div id="rolesTab" class="tab-content">
                    <h2>Manage Roles</h2>
                    <form id="rolesForm">
                        <div class="form-group">
                            <label for="rolesTokenAddress">Token Contract Address</label>
                            <input type="text" id="rolesTokenAddress" placeholder="0x..." required>
                        </div>
                        <div class="form-group">
                            <label for="roleAccount">Account Address</label>
                            <input type="text" id="roleAccount" placeholder="0x..." required>
                        </div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button type="button" class="btn" onclick="grantMinterRole()">
                                Grant Minter Role
                            </button>
                            <button type="button" class="btn btn-danger" onclick="revokeMinterRole()">
                                Revoke Minter Role
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Metadata Tab -->
                <div id="metadataTab" class="tab-content">
                    <h2>Set Token Metadata</h2>
                    <form id="metadataForm">
                        <div class="form-group">
                            <label for="metadataTokenAddress">Token Contract Address</label>
                            <input type="text" id="metadataTokenAddress" placeholder="0x..." required>
                        </div>
                        <div class="form-group">
                            <label for="metadataRegistryAddress">Registry Contract Address</label>
                            <input type="text" id="metadataRegistryAddress" placeholder="0x..." required>
                        </div>
                        <div class="form-group">
                            <label for="metadataURI">Metadata URI</label>
                            <input type="text" id="metadataURI" placeholder="ipfs://... or https://..." required>
                        </div>
                        <button type="submit" class="btn" id="metadataBtn">
                            Set Metadata
                        </button>
                    </form>
                </div>
                
                <!-- Transfer Tab -->
                <div id="transferTab" class="tab-content">
                    <h2>Transfer Tokens</h2>
                    <form id="transferForm">
                        <div class="form-group">
                            <label for="transferTokenAddress">Token Contract Address</label>
                            <input type="text" id="transferTokenAddress" placeholder="0x..." required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="transferRecipient">Recipient Address</label>
                                <input type="text" id="transferRecipient" placeholder="0x..." required>
                            </div>
                            <div class="form-group">
                                <label for="transferAmount">Amount</label>
                                <input type="number" id="transferAmount" placeholder="10" min="0" step="0.000001" required>
                            </div>
                        </div>
                        <button type="submit" class="btn" id="transferBtn">
                            Transfer Tokens
                        </button>
                    </form>
                </div>
                
                <!-- Existing Tokens Tab -->
                <div id="existingTab" class="tab-content">
                    <h2>Load Existing Token</h2>
                    <form id="existingForm">
                        <div class="form-group">
                            <label for="existingTokenAddress">Token Contract Address</label>
                            <input type="text" id="existingTokenAddress" placeholder="0x5DE34E3529fb0B036b6fB8f7A1D2f83A3f19BeCb" required>
                        </div>
                        <button type="submit" class="btn">
                            Load Token Info
                        </button>
                    </form>
                    
                    <div id="tokenInfo" class="advanced-section" style="display: none;">
                        <h3>Token Information</h3>
                        <div id="tokenDetails"></div>
                        <div style="margin-top: 20px;">
                            <button class="btn" onclick="useTokenForMinting()">Use for Minting</button>
                            <button class="btn" onclick="useTokenForRoles()">Use for Roles</button>
                            <button class="btn" onclick="useTokenForTransfer()">Use for Transfer</button>
                            <button class="btn" onclick="saveCurrentToken()">Save to My Tokens</button>
                        </div>
                    </div>
                </div>
                
                <!-- Manage Tokens Tab -->
                <div id="manageTab" class="tab-content">
                    <div class="management-header">
                        <h2>Manage Your Tokens</h2>
                        <button class="refresh-btn" onclick="refreshAllTokens()">
                            🔄 Refresh All
                        </button>
                    </div>
                    
                    <div class="token-management">
                        <h3>Saved Tokens</h3>
                        <p style="color: #6b7280; margin-bottom: 20px;">
                            Your deployed and saved tokens will appear here. You can quickly access them for various operations.
                        </p>
                        
                        <div id="savedTokensList" class="saved-tokens-grid">
                            <div class="no-tokens">
                                <p>No tokens saved yet. Deploy a new token or load an existing one to get started.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="advanced-section">
                        <h3>Import Existing Token</h3>
                        <form id="importForm" style="display: flex; gap: 10px; align-items: end;">
                            <div class="form-group" style="flex: 1;">
                                <label for="importTokenAddress">Token Contract Address</label>
                                <input type="text" id="importTokenAddress" placeholder="0x..." required>
                            </div>
                            <button type="submit" class="btn" style="height: fit-content;">
                                Import Token
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            
            <div id="statusMessages"></div>
        </div>
    </div>

    <script>
        // Smart contract ABI - based on your MyToken.sol
        const TOKEN_ABI = [
            "constructor(string memory name, string memory symbol)",
            "function name() view returns (string)",
            "function symbol() view returns (string)",
            "function decimals() view returns (uint8)",
            "function totalSupply() view returns (uint256)",
            "function balanceOf(address account) view returns (uint256)",
            "function mint(address to, uint256 amount) external",
            "function transfer(address to, uint256 amount) returns (bool)",
            "function grantRole(bytes32 role, address account) external",
            "function revokeRole(bytes32 role, address account) external",
            "function hasRole(bytes32 role, address account) view returns (bool)",
            "event Transfer(address indexed from, address indexed to, uint256 value)",
            "event RoleGranted(bytes32 indexed role, address indexed account, address indexed sender)"
        ];
        
        const REGISTRY_ABI = [
            "constructor(address admin)",
            "function setMetadata(address tokenAddress, string memory metadataURI) external",
            "function getMetadata(address tokenAddress) view returns (string)",
            "event MetadataSet(address indexed tokenAddress, string metadataURI)"
        ];

        // Contract bytecode - you'll need to get this from your compiled contract
        const TOKEN_BYTECODE = "0x60806040523480156200001157600080fd5b5060405162003f7338038062003f73833981810160405281019062000037919062000555565b8181818181600590816200004c919062000825565b5080600690816200005e919062000825565b5050506000600760006101000a81548160ff021916908315150217905550620000a06000801b620000946200012c60201b60201c565b6200013460201b60201c565b620000e17f9f2df0fed2c77648de5860a4cc508cd0818c85b8b8a1ab4ceeef8d981c8956a6620000d56200012c60201b60201c565b6200013460201b60201c565b620001227f65d7a28e3265b37a6474929f336521b332c1681b933f6cb9f3376673440d862a620001166200012c60201b60201c565b6200013460201b60201c565b505050506200090c565b600033905090565b6200014682826200014a60201b60201c565b5050565b6200016182826200019260201b62000e431760201c565b6200018d81600160008581526020019081526020016000206200028360201b62000f231790919060201c565b505050565b620001a48282620002bb60201b60201c565b6200027f57600160008084815260200190815260200160002060000160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff021916908315150217905550620002246200012c60201b60201c565b73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16837f2f8788117e7eff1d82e926ec794901d17c78024a50270940304540a733656f0d60405160405180910390a45b5050565b6000620002b3836000018373ffffffffffffffffffffffffffffffffffffffff1660001b6200032560201b60201c565b905092915050565b600080600084815260200190815260200160002060000160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16905092915050565b60006200033983836200039f60201b60201c565b6200039457826000018290806001815401808255809150506001900390600052602060002001600090919091909150558260000180549050836001016000848152602001908152602001600020819055506001905062000399565b600090505b92915050565b600080836001016000848152602001908152602001600020541415905092915050565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6200042b82620003e0565b810181811067ffffffffffffffff821117156200044d576200044c620003f1565b5b80604052505050565b600062000462620003c2565b905062000470828262000420565b919050565b600067ffffffffffffffff821115620004935762000492620003f1565b5b6200049e82620003e0565b9050602081019050919050565b60005b83811015620004cb578082015181840152602081019050620004ae565b60008484015250505050565b6000620004ee620004e88462000475565b62000456565b9050828152602081018484840111156200050d576200050c620003db565b5b6200051a848285620004ab565b509392505050565b600082601f8301126200053a5762000539620003d6565b5b81516200054c848260208601620004d7565b91505092915050565b600080604083850312156200056f576200056e620003cc565b5b600083015167ffffffffffffffff81111562000590576200058f620003d1565b5b6200059e8582860162000522565b925050602083015167ffffffffffffffff811115620005c257620005c1620003d1565b5b620005d08582860162000522565b9150509250929050565b600081519050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806200062d57607f821691505b602082108103620006435762000642620005e5565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b600060088302620006ad7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff826200066e565b620006b986836200066e565b95508019841693508086168417925050509392505050565b6000819050919050565b6000819050919050565b60006200070662000700620006fa84620006d1565b620006db565b620006d1565b9050919050565b6000819050919050565b6200072283620006e5565b6200073a62000731826200070d565b8484546200067b565b825550505050565b600090565b6200075162000742565b6200075e81848462000717565b505050565b5b8181101562000786576200077a60008262000747565b60018101905062000764565b5050565b601f821115620007d5576200079f8162000649565b620007aa846200065e565b81016020851015620007ba578190505b620007d2620007c9856200065e565b83018262000763565b50505b505050565b600082821c905092915050565b6000620007fa60001984600802620007da565b1980831691505092915050565b6000620008158383620007e7565b9150826002028217905092915050565b6200083082620005da565b67ffffffffffffffff8111156200084c576200084b620003f1565b5b62000858825462000614565b620008658282856200078a565b600060209050601f8311600181146200089d576000841562000888578287015190505b62000894858262000807565b86555062000904565b601f198416620008ad8662000649565b60005b82811015620008d757848901518255600182019150602085019450602081019050620008b0565b86831015620008f75784890151620008f3601f891682620007e7565b8355505b6001600288020188555050505b505050505050565b613657806200091c6000396000f3fe608060405234801561001057600080fd5b50600436106101da5760003560e01c806377a4d55911610104578063a457c2d7116100a2578063d539139311610071578063d53913931461057d578063d547741f1461059b578063dd62ed3e146105b7578063e63ab1e9146105e7576101da565b8063a457c2d7146104d1578063a49a1e7d14610501578063a9059cbb1461051d578063ca15c8731461054d576101da565b80639010d07c116100de5780639010d07c1461043557806391d148541461046557806395d89b4114610495578063a217fddf146104b3576101da565b806377a4d559146103f157806379cc67901461040f5780638456cb591461042b576101da565b8063313ce5671161017c57806340c10f191161014b57806340c10f191461036b57806342966c68146103875780635c975abb146103a357806370a08231146103c1576101da565b8063313ce567146102f757806336568abe1461031557806339509351146103315780633f4ba83a14610361576101da565b806318160ddd116101b857806318160ddd1461025d57806323b872dd1461027b578063248a9ca3146102ab5780632f2ff15d146102db576101da565b806301ffc9a7146101df57806306fdde031461020f578063095ea7b31461022d575b600080fd5b6101f960048036038101906101f491906120f7565b610605565b604051610206919061213f565b60405180910390f35b61021761067f565b60405161022491906121ea565b60405180910390f35b610247600480360381019061024291906122a0565b610711565b604051610254919061213f565b60405180910390f35b610265610734565b60405161027291906122ef565b60405180910390f35b6102956004803603810190610290919061230a565b61073e565b6040516102a2919061213f565b60405180910390f35b6102c560048036038101906102c09190612393565b61076d565b6040516102d291906123cf565b60405180910390f35b6102f560048036038101906102f091906123ea565b61078c565b005b6102ff6107ad565b60405161030c9190612446565b60405180910390f35b61032f600480360381019061032a91906123ea565b6107b6565b005b61034b600480360381019061034691906122a0565b610839565b604051610358919061213f565b60405180910390f35b610369610870565b005b610385600480360381019061038091906122a0565b6108ea565b005b6103a1600480360381019061039c9190612461565b610968565b005b6103ab61097c565b6040516103b8919061213f565b60405180910390f35b6103db60048036038101906103d6919061248e565b610993565b6040516103e891906122ef565b60405180910390f35b6103f96109dc565b60405161040691906121ea565b60405180910390f35b610429600480360381019061042491906122a0565b610a6a565b005b610433610a8a565b005b61044f600480360381019061044a91906124bb565b610b04565b60405161045c919061250a565b60405180910390f35b61047f600480360381019061047a91906123ea565b610b33565b60405161048c919061213f565b60405180910390f35b61049d610b9d565b6040516104aa91906121ea565b60405180910390f35b6104bb610c2f565b6040516104c891906123cf565b60405180910390f35b6104eb60048036038101906104e691906122a0565b610c36565b6040516104f8919061213f565b60405180910390f35b61051b6004803603810190610516919061265a565b610cad565b005b610537600480360381019061053291906122a0565b610d0c565b604051610544919061213f565b60405180910390f35b61056760048036038101906105629190612393565b610d2f565b60405161057491906122ef565b60405180910390f35b610585610d53565b60405161059291906123cf565b60405180910390f35b6105b560048036038101906105b091906123ea565b610d77565b005b6105d160048036038101906105cc91906126a3565b610d98565b6040516105de91906122ef565b60405180910390f35b6105ef610e1f565b6040516105fc91906123cf565b60405180910390f35b60007f5a05180f000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19161480610678575061067782610f53565b5b9050919050565b60606005805461068e90612712565b80601f01602080910402602001604051908101604052809291908181526020018280546106ba90612712565b80156107075780601f106106dc57610100808354040283529160200191610707565b820191906000526020600020905b8154815290600101906020018083116106ea57829003601f168201915b5050505050905090565b60008061071c610fcd565b9050610729818585610fd5565b600191505092915050565b6000600454905090565b600080610749610fcd565b905061075685828561119e565b61076185858561122a565b60019150509392505050565b6000806000838152602001908152602001600020600101549050919050565b6107958261076d565b61079e816114a3565b6107a883836114b7565b505050565b60006012905090565b6107be610fcd565b73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff161461082b576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610822906127b5565b60405180910390fd5b61083582826114eb565b5050565b600080610844610fcd565b90506108658185856108568589610d98565b6108609190612804565b610fd5565b600191505092915050565b6108a17f65d7a28e3265b37a6474929f336521b332c1681b933f6cb9f3376673440d862a61089c610fcd565b610b33565b6108e0576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016108d7906128aa565b60405180910390fd5b6108e861151f565b565b61091b7f9f2df0fed2c77648de5860a4cc508cd0818c85b8b8a1ab4ceeef8d981c8956a6610916610fcd565b610b33565b61095a576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016109519061293c565b60405180910390fd5b6109648282611582565b5050565b610979610973610fcd565b826116d9565b50565b6000600760009054906101000a900460ff16905090565b6000600260008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b600880546109e990612712565b80601f0160208091040260200160405190810160405280929190818152602001828054610a1590612712565b8015610a625780601f10610a3757610100808354040283529160200191610a62565b820191906000526020600020905b815481529060010190602001808311610a4557829003601f168201915b505050505081565b610a7c82610a76610fcd565b8361119e565b610a8682826116d9565b5050565b610abb7f65d7a28e3265b37a6474929f336521b332c1681b933f6cb9f3376673440d862a610ab6610fcd565b610b33565b610afa576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610af1906129ce565b60405180910390fd5b610b026118a8565b565b6000610b2b826001600086815260200190815260200160002061190b90919063ffffffff16565b905092915050565b600080600084815260200190815260200160002060000160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16905092915050565b606060068054610bac90612712565b80601f0160208091040260200160405190810160405280929190818152602001828054610bd890612712565b8015610c255780601f10610bfa57610100808354040283529160200191610c25565b820191906000526020600020905b815481529060010190602001808311610c0857829003601f168201915b5050505050905090565b6000801b81565b600080610c41610fcd565b90506000610c4f8286610d98565b905083811015610c94576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610c8b90612a60565b60405180910390fd5b610ca18286868403610fd5565b60019250505092915050565b610cba6000801b33610b33565b610cf9576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610cf090612acc565b60405180910390fd5b8060089081610d089190612c98565b5050565b600080610d17610fcd565b9050610d2481858561122a565b600191505092915050565b6000610d4c60016000848152602001908152602001600020611925565b9050919050565b7f9f2df0fed2c77648de5860a4cc508cd0818c85b8b8a1ab4ceeef8d981c8956a681565b610d808261076d565b610d89816114a3565b610d9383836114eb565b505050565b6000600360008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905092915050565b7f65d7a28e3265b37a6474929f336521b332c1681b933f6cb9f3376673440d862a81565b610e4d8282610b33565b610f1f57600160008084815260200190815260200160002060000160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff021916908315150217905550610ec4610fcd565b73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16837f2f8788117e7eff1d82e926ec794901d17c78024a50270940304540a733656f0d60405160405180910390a45b5050565b6000610f4b836000018373ffffffffffffffffffffffffffffffffffffffff1660001b61193a565b905092915050565b60007f7965db0b000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19161480610fc65750610fc5826119aa565b5b9050919050565b600033905090565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603611044576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161103b90612ddc565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16036110b3576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016110aa90612e6e565b60405180910390fd5b80600360008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9258360405161119191906122ef565b60405180910390a3505050565b60006111aa8484610d98565b90507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff81146112245781811015611216576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161120d90612eda565b60405180910390fd5b6112238484848403610fd5565b5b50505050565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603611299576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161129090612f6c565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603611308576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016112ff90612ffe565b60405180910390fd5b611313838383611a14565b6000600260008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490508181101561139a576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161139190613090565b60405180910390fd5b818103600260008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555081600260008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055508273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef8460405161148a91906122ef565b60405180910390a361149d848484611a24565b50505050565b6114b4816114af610fcd565b611a29565b50565b6114c18282610e43565b6114e68160016000858152602001908152602001600020610f2390919063ffffffff16565b505050565b6114f58282611aae565b61151a8160016000858152602001908152602001600020611b8f90919063ffffffff16565b505050565b611527611bbf565b6000600760006101000a81548160ff0219169083151502179055507f5db9ee0a495bf2e6ff9c91a7834c1ba4fdd244a5e8aa4e537bd38aeae4b073aa61156b610fcd565b604051611578919061250a565b60405180910390a1565b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16036115f1576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016115e8906130fc565b60405180910390fd5b6115fd60008383611a14565b806004600082825461160f9190612804565b9250508190555080600260008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055508173ffffffffffffffffffffffffffffffffffffffff16600073ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef836040516116c191906122ef565b60405180910390a36116d560008383611a24565b5050565b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603611748576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161173f9061318e565b60405180910390fd5b61175482600083611a14565b6000600260008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050818110156117db576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016117d290613220565b60405180910390fd5b818103600260008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555081600460008282540392505081905550600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef8460405161188f91906122ef565b60405180910390a36118a383600084611a24565b505050565b6118b0611c08565b6001600760006101000a81548160ff0219169083151502179055507f62e78cea01bee320cd4e420270b5ea74000d11b0c9f74754ebdbfc544b05a2586118f4610fcd565b604051611901919061250a565b60405180910390a1565b600061191a8360000183611c52565b60001c905092915050565b600061193382600001611c7d565b9050919050565b60006119468383611c8e565b61199f5782600001829080600181540180825580915050600190039060005260206000200160009091909190915055826000018054905083600101600084815260200190815260200160002081905550600190506119a4565b600090505b92915050565b60007f01ffc9a7000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916149050919050565b611a1f838383611cb1565b505050565b505050565b611a338282610b33565b611aaa57611a4081611d09565b611a4e8360001c6020611d36565b604051602001611a5f929190613314565b6040516020818303038152906040526040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611aa191906121ea565b60405180910390fd5b5050565b611ab88282610b33565b15611b8b57600080600084815260200190815260200160002060000160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff021916908315150217905550611b30610fcd565b73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16837ff6391f5c32d9c69d2a47ea670b442974b53935d1edc7fd64eb21e047a839171b60405160405180910390a45b5050565b6000611bb7836000018373ffffffffffffffffffffffffffffffffffffffff1660001b611f72565b905092915050565b611bc761097c565b611c06576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611bfd9061339a565b60405180910390fd5b565b611c1061097c565b15611c50576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611c4790613406565b60405180910390fd5b565b6000826000018281548110611c6a57611c69613426565b5b9060005260206000200154905092915050565b600081600001805490509050919050565b600080836001016000848152602001908152602001600020541415905092915050565b611cbc838383612086565b611cc461097c565b15611d04576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611cfb906134c7565b60405180910390fd5b505050565b6060611d2f8273ffffffffffffffffffffffffffffffffffffffff16601460ff16611d36565b9050919050565b606060006002836002611d4991906134e7565b611d539190612804565b67ffffffffffffffff811115611d6c57611d6b61252f565b5b6040519080825280601f01601f191660200182016040528015611d9e5781602001600182028036833780820191505090505b5090507f300000000000000000000000000000000000000000000000000000000000000081600081518110611dd657611dd5613426565b5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053507f780000000000000000000000000000000000000000000000000000000000000081600181518110611e3a57611e39613426565b5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a90535060006001846002611e7a91906134e7565b611e849190612804565b90505b6001811115611f24577f3031323334353637383961626364656600000000000000000000000000000000600f861660108110611ec657611ec5613426565b5b1a60f81b828281518110611edd57611edc613426565b5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a905350600485901c945080611f1d90613529565b9050611e87565b5060008414611f68576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611f5f9061359e565b60405180910390fd5b8091505092915050565b6000808360010160008481526020019081526020016000205490506000811461207a576000600182611fa491906135be565b9050600060018660000180549050611fbc91906135be565b905081811461202b576000866000018281548110611fdd57611fdc613426565b5b906000526020600020015490508087600001848154811061200157612000613426565b5b90600052602060002001819055508387600101600083815260200190815260200160002081905550505b8560000180548061203f5761203e6135f2565b5b600190038181906000526020600020016000905590558560010160008681526020019081526020016000206000905560019350505050612080565b60009150505b92915050565b505050565b6000604051905090565b600080fd5b600080fd5b60007fffffffff0000000000000000000000000000000000000000000000000000000082169050919050565b6120d48161209f565b81146120df57600080fd5b50565b6000813590506120f1816120cb565b92915050565b60006020828403121561210d5761210c612095565b5b600061211b848285016120e2565b91505092915050565b60008115159050919050565b61213981612124565b82525050565b60006020820190506121546000830184612130565b92915050565b600081519050919050565b600082825260208201905092915050565b60005b83811015612194578082015181840152602081019050612179565b60008484015250505050565b6000601f19601f8301169050919050565b60006121bc8261215a565b6121c68185612165565b93506121d6818560208601612176565b6121df816121a0565b840191505092915050565b6000602082019050818103600083015261220481846121b1565b905092915050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006122378261220c565b9050919050565b6122478161222c565b811461225257600080fd5b50565b6000813590506122648161223e565b92915050565b6000819050919050565b61227d8161226a565b811461228857600080fd5b50565b60008135905061229a81612274565b92915050565b600080604083850312156122b7576122b6612095565b5b60006122c585828601612255565b92505060206122d68582860161228b565b9150509250929050565b6122e98161226a565b82525050565b600060208201905061230460008301846122e0565b92915050565b60008060006060848603121561232357612322612095565b5b600061233186828701612255565b935050602061234286828701612255565b92505060406123538682870161228b565b9150509250925092565b6000819050919050565b6123708161235d565b811461237b57600080fd5b50565b60008135905061238d81612367565b92915050565b6000602082840312156123a9576123a8612095565b5b60006123b78482850161237e565b91505092915050565b6123c98161235d565b82525050565b60006020820190506123e460008301846123c0565b92915050565b6000806040838503121561240157612400612095565b5b600061240f8582860161237e565b925050602061242085828601612255565b9150509250929050565b600060ff82169050919050565b6124408161242a565b82525050565b600060208201905061245b6000830184612437565b92915050565b60006020828403121561247757612476612095565b5b60006124858482850161228b565b91505092915050565b6000602082840312156124a4576124a3612095565b5b60006124b284828501612255565b91505092915050565b600080604083850312156124d2576124d1612095565b5b60006124e08582860161237e565b92505060206124f18582860161228b565b9150509250929050565b6125048161222c565b82525050565b600060208201905061251f60008301846124fb565b92915050565b600080fd5b600080fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b612567826121a0565b810181811067ffffffffffffffff821117156125865761258561252f565b5b80604052505050565b600061259961208b565b90506125a5828261255e565b919050565b600067ffffffffffffffff8211156125c5576125c461252f565b5b6125ce826121a0565b9050602081019050919050565b82818337600083830152505050565b60006125fd6125f8846125aa565b61258f565b9050828152602081018484840111156126195761261861252a565b5b6126248482856125db565b509392505050565b600082601f83011261264157612640612525565b5b81356126518482602086016125ea565b91505092915050565b6000602082840312156126705761266f612095565b5b600082013567ffffffffffffffff81111561268e5761268d61209a565b5b61269a8482850161262c565b91505092915050565b600080604083850312156126ba576126b9612095565b5b60006126c885828601612255565b92505060206126d985828601612255565b9150509250929050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b6000600282049050600182168061272a57607f821691505b60208210810361273d5761273c6126e3565b5b50919050565b7f416363657373436f6e74726f6c3a2063616e206f6e6c792072656e6f756e636560008201527f20726f6c657320666f722073656c660000000000000000000000000000000000602082015250565b600061279f602f83612165565b91506127aa82612743565b604082019050919050565b600060208201905081810360008301526127ce81612792565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b600061280f8261226a565b915061281a8361226a565b9250828201905080821115612832576128316127d5565b5b92915050565b7f45524332305072657365744d696e7465725061757365723a206d75737420686160008201527f76652070617573657220726f6c6520746f20756e706175736500000000000000602082015250565b6000612894603983612165565b915061289f82612838565b604082019050919050565b600060208201905081810360008301526128c381612887565b9050919050565b7f45524332305072657365744d696e7465725061757365723a206d75737420686160008201527f7665206d696e74657220726f6c6520746f206d696e7400000000000000000000602082015250565b6000612926603683612165565b9150612931826128ca565b604082019050919050565b6000602082019050818103600083015261295581612919565b9050919050565b7f45524332305072657365744d696e7465725061757365723a206d75737420686160008201527f76652070617573657220726f6c6520746f207061757365000000000000000000602082015250565b60006129b8603783612165565b91506129c38261295c565b604082019050919050565b600060208201905081810360008301526129e7816129ab565b9050919050565b7f45524332303a2064656372656173656420616c6c6f77616e63652062656c6f7760008201527f207a65726f000000000000000000000000000000000000000000000000000000602082015250565b6000612a4a602583612165565b9150612a55826129ee565b604082019050919050565b60006020820190508181036000830152612a7981612a3d565b9050919050565b7f4e6f742061646d696e0000000000000000000000000000000000000000000000600082015250565b6000612ab6600983612165565b9150612ac182612a80565b602082019050919050565b60006020820190508181036000830152612ae581612aa9565b9050919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b600060088302612b4e7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82612b11565b612b588683612b11565b95508019841693508086168417925050509392505050565b6000819050919050565b6000612b95612b90612b8b8461226a565b612b70565b61226a565b9050919050565b6000819050919050565b612baf83612b7a565b612bc3612bbb82612b9c565b848454612b1e565b825550505050565b600090565b612bd8612bcb565b612be3818484612ba6565b505050565b5b81811015612c0757612bfc600082612bd0565b600181019050612be9565b5050565b601f821115612c4c57612c1d81612aec565b612c2684612b01565b81016020851015612c35578190505b612c49612c4185612b01565b830182612be8565b50505b505050565b600082821c905092915050565b6000612c6f60001984600802612c51565b1980831691505092915050565b6000612c888383612c5e565b9150826002028217905092915050565b612ca18261215a565b67ffffffffffffffff811115612cba57612cb961252f565b5b612cc48254612712565b612ccf828285612c0b565b600060209050601f831160018114612d025760008415612cf0578287015190505b612cfa8582612c7c565b865550612d62565b601f198416612d1086612aec565b60005b82811015612d3857848901518255600182019150602085019450602081019050612d13565b86831015612d555784890151612d51601f891682612c5e565b8355505b6001600288020188555050505b505050505050565b7f45524332303a20617070726f76652066726f6d20746865207a65726f2061646460008201527f7265737300000000000000000000000000000000000000000000000000000000602082015250565b6000612dc6602483612165565b9150612dd182612d6a565b604082019050919050565b60006020820190508181036000830152612df581612db9565b9050919050565b7f45524332303a20617070726f766520746f20746865207a65726f20616464726560008201527f7373000000000000000000000000000000000000000000000000000000000000602082015250565b6000612e58602283612165565b9150612e6382612dfc565b604082019050919050565b60006020820190508181036000830152612e8781612e4b565b9050919050565b7f45524332303a20696e73756666696369656e7420616c6c6f77616e6365000000600082015250565b6000612ec4601d83612165565b9150612ecf82612e8e565b602082019050919050565b60006020820190508181036000830152612ef381612eb7565b9050919050565b7f45524332303a207472616e736665722066726f6d20746865207a65726f20616460008201527f6472657373000000000000000000000000000000000000000000000000000000602082015250565b6000612f56602583612165565b9150612f6182612efa565b604082019050919050565b60006020820190508181036000830152612f8581612f49565b9050919050565b7f45524332303a207472616e7366657220746f20746865207a65726f206164647260008201527f6573730000000000000000000000000000000000000000000000000000000000602082015250565b6000612fe8602383612165565b9150612ff382612f8c565b604082019050919050565b6000602082019050818103600083015261301781612fdb565b9050919050565b7f45524332303a207472616e7366657220616d6f756e742065786365656473206260008201527f616c616e63650000000000000000000000000000000000000000000000000000602082015250565b600061307a602683612165565b91506130858261301e565b604082019050919050565b600060208201905081810360008301526130a98161306d565b9050919050565b7f45524332303a206d696e7420746f20746865207a65726f206164647265737300600082015250565b60006130e6601f83612165565b91506130f1826130b0565b602082019050919050565b60006020820190508181036000830152613115816130d9565b9050919050565b7f45524332303a206275726e2066726f6d20746865207a65726f2061646472657360008201527f7300000000000000000000000000000000000000000000000000000000000000602082015250565b6000613178602183612165565b91506131838261311c565b604082019050919050565b600060208201905081810360008301526131a78161316b565b9050919050565b7f45524332303a206275726e20616d6f756e7420657863656564732062616c616e60008201527f6365000000000000000000000000000000000000000000000000000000000000602082015250565b600061320a602283612165565b9150613215826131ae565b604082019050919050565b60006020820190508181036000830152613239816131fd565b9050919050565b600081905092915050565b7f416363657373436f6e74726f6c3a206163636f756e7420000000000000000000600082015250565b6000613281601783613240565b915061328c8261324b565b601782019050919050565b60006132a28261215a565b6132ac8185613240565b93506132bc818560208601612176565b80840191505092915050565b7f206973206d697373696e6720726f6c6520000000000000000000000000000000600082015250565b60006132fe601183613240565b9150613309826132c8565b601182019050919050565b600061331f82613274565b915061332b8285613297565b9150613336826132f1565b91506133428284613297565b91508190509392505050565b7f5061757361626c653a206e6f7420706175736564000000000000000000000000600082015250565b6000613384601483612165565b915061338f8261334e565b602082019050919050565b600060208201905081810360008301526133b381613377565b9050919050565b7f5061757361626c653a2070617573656400000000000000000000000000000000600082015250565b60006133f0601083612165565b91506133fb826133ba565b602082019050919050565b6000602082019050818103600083015261341f816133e3565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f45524332305061757361626c653a20746f6b656e207472616e7366657220776860008201527f696c652070617573656400000000000000000000000000000000000000000000602082015250565b60006134b1602a83612165565b91506134bc82613455565b604082019050919050565b600060208201905081810360008301526134e0816134a4565b9050919050565b60006134f28261226a565b91506134fd8361226a565b925082820261350b8161226a565b91508282048414831517613522576135216127d5565b5b5092915050565b60006135348261226a565b915060008203613547576135466127d5565b5b600182039050919050565b7f537472696e67733a20686578206c656e67746820696e73756666696369656e74600082015250565b6000613588602083612165565b915061359382613552565b602082019050919050565b600060208201905081810360008301526135b78161357b565b9050919050565b60006135c98261226a565b91506135d48361226a565b92508282039050818111156135ec576135eb6127d5565b5b92915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603160045260246000fdfea2646970667358221220524c1df46750b771e1d129d1d0c32296546107c66ffe3c87727a4866fbcaf18064736f6c63430008120033";
        
        const HEDERA_NETWORKS = {
            mainnet: {
                chainId: "0x127", // 295
                chainName: "Hedera Mainnet",
                nativeCurrency: {
                    name: "HBAR",
                    symbol: "HBAR",
                    decimals: 18
                },
                rpcUrls: ["https://mainnet.hashio.io/api"],
                blockExplorerUrls: ["https://hashscan.io/mainnet"]
            },
            testnet: {
                chainId: "0x128", // 296
                chainName: "Hedera Testnet",
                nativeCurrency: {
                    name: "HBAR",
                    symbol: "HBAR",
                    decimals: 18
                },
                rpcUrls: ["https://testnet.hashio.io/api"],
                blockExplorerUrls: ["https://hashscan.io/testnet"]
            }
        };

        // change this if you want to use mainnet instead
        const TARGET_NETWORK = HEDERA_NETWORKS.testnet; 
        
        let web3Provider = null;
        let signer = null;
        let userAddress = null;
        let currentTokenInfo = null;
        let savedTokens = [];

        // MINTER_ROLE constant
        const MINTER_ROLE = ethers.utils.id("MINTER_ROLE");

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            loadSavedTokens();
            checkWalletConnection();
        });

        function setupEventListeners() {
            document.getElementById('connectWallet').addEventListener('click', connectWallet);
            document.getElementById('deployForm').addEventListener('submit', deployToken);
            document.getElementById('mintForm').addEventListener('submit', mintTokens);
            document.getElementById('metadataForm').addEventListener('submit', setMetadata);
            document.getElementById('transferForm').addEventListener('submit', transferTokens);
            document.getElementById('existingForm').addEventListener('submit', loadExistingToken);
            document.getElementById('importForm').addEventListener('submit', importExistingToken);
        }

        async function checkWalletConnection() {
            if (typeof window.ethereum !== "undefined") {
                try {
                    const accounts = await window.ethereum.request({ method: "eth_accounts" });
                    if (accounts.length > 0) {
                        await ensureCorrectNetwork();
                        await initializeWallet();
                    }
                } catch (error) {
                    console.error("Error checking wallet connection:", error);
                }
            }
        }

        async function connectWallet() {
            if (typeof window.ethereum === "undefined") {
                showMessage("MetaMask is not installed. Please install MetaMask to continue.", "error");
                return;
            }

            try {
                const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
                if (accounts.length > 0) {
                    await ensureCorrectNetwork();
                    await initializeWallet();
                    showMessage("Wallet connected successfully!", "success");
                }
            } catch (error) {
                console.error("Error connecting wallet:", error);
                showMessage("Failed to connect wallet: " + error.message, "error");
            }
        }

        async function ensureCorrectNetwork() {
            try {
                const currentChainId = await window.ethereum.request({ method: "eth_chainId" });

                if (currentChainId !== TARGET_NETWORK.chainId) {
                    try {
                        // Try switching to Hedera
                        await window.ethereum.request({
                            method: "wallet_switchEthereumChain",
                            params: [{ chainId: TARGET_NETWORK.chainId }]
                        });
                        showMessage(`Switched to ${TARGET_NETWORK.chainName}`, "info");
                    } catch (switchError) {
                        // If not added, request to add the chain
                        if (switchError.code === 4902) {
                            try {
                                await window.ethereum.request({
                                    method: "wallet_addEthereumChain",
                                    params: [TARGET_NETWORK]
                                });
                                showMessage(`Added and switched to ${TARGET_NETWORK.chainName}`, "info");
                            } catch (addError) {
                                console.error("Failed to add Hedera network:", addError);
                                showMessage("Please add Hedera network manually in MetaMask.", "error");
                            }
                        } else {
                            console.error("Error switching network:", switchError);
                            showMessage("Failed to switch to Hedera network.", "error");
                        }
                    }
                }
            } catch (error) {
                console.error("Network check failed:", error);
            }
        }

        async function initializeWallet() {
            try {
                web3Provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = web3Provider.getSigner();
                userAddress = await signer.getAddress();

                const network = await web3Provider.getNetwork();

                document.getElementById("walletStatus").textContent =
                    `Connected: ${userAddress.slice(0, 6)}...${userAddress.slice(-4)} | Network: ${network.name}`;

                document.getElementById("connectSection").style.display = "none";
                document.getElementById("mainApp").style.display = "block";

                // Pre-fill user address in recipient fields
                document.getElementById("mintRecipient").value = userAddress;
                
                // Refresh saved tokens with current wallet
                refreshAllTokens();
            } catch (error) {
                console.error("Error initializing wallet:", error);
                showMessage("Failed to initialize wallet", "error");
            }
        }

        function showTab(tabName, element) {
            // Hide all tab contents
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content and mark tab as active
            document.getElementById(tabName + 'Tab').classList.add('active');
            if (element) {
                element.classList.add('active');
            }
        }

        // Token Management Functions
        function loadSavedTokens() {
            const saved = localStorage.getItem('hederaSavedTokens');
            if (saved) {
                savedTokens = JSON.parse(saved);
                updateSavedTokensList();
            }
        }

        function saveTokensToStorage() {
            localStorage.setItem('hederaSavedTokens', JSON.stringify(savedTokens));
        }

        function addTokenToSaved(tokenInfo) {
            // Check if token already exists
            const existingIndex = savedTokens.findIndex(token => 
                token.address.toLowerCase() === tokenInfo.address.toLowerCase()
            );
            
            if (existingIndex === -1) {
                tokenInfo.savedAt = new Date().toISOString();
                tokenInfo.lastUpdated = new Date().toISOString();
                savedTokens.push(tokenInfo);
                saveTokensToStorage();
                updateSavedTokensList();
                showMessage(`Token ${tokenInfo.symbol} saved successfully!`, 'success');
                return true;
            } else {
                showMessage('Token already exists in your saved tokens', 'info');
                return false;
            }
        }

        function updateTokenInfo(tokenAddress, newInfo) {
            const tokenIndex = savedTokens.findIndex(token => 
                token.address.toLowerCase() === tokenAddress.toLowerCase()
            );
            
            if (tokenIndex !== -1) {
                savedTokens[tokenIndex] = {
                    ...savedTokens[tokenIndex],
                    ...newInfo,
                    lastUpdated: new Date().toISOString()
                };
                saveTokensToStorage();
                updateSavedTokensList();
                return true;
            }
            return false;
        }

        function removeToken(tokenAddress) {
            if (confirm('Are you sure you want to remove this token from your saved list?')) {
                savedTokens = savedTokens.filter(token => 
                    token.address.toLowerCase() !== tokenAddress.toLowerCase()
                );
                saveTokensToStorage();
                updateSavedTokensList();
                showMessage('Token removed from saved list', 'success');
            }
        }

        async function refreshTokenInfo(tokenAddress) {
            try {
                const contract = new ethers.Contract(tokenAddress, TOKEN_ABI, signer);
                
                const [name, symbol, decimals, totalSupply] = await Promise.all([
                    contract.name(),
                    contract.symbol(),
                    contract.decimals(),
                    contract.totalSupply()
                ]);
                
                const userBalance = await contract.balanceOf(userAddress);
                const hasMinterRole = await contract.hasRole(MINTER_ROLE, userAddress);
                
                const tokenInfo = {
                    address: tokenAddress,
                    name: name,
                    symbol: symbol,
                    decimals: decimals,
                    totalSupply: ethers.utils.formatUnits(totalSupply, decimals),
                    userBalance: ethers.utils.formatUnits(userBalance, decimals),
                    hasMinterRole: hasMinterRole,
                    lastUpdated: new Date().toISOString()
                };
                
                updateTokenInfo(tokenAddress, tokenInfo);
                return true;
                
            } catch (error) {
                console.error('Error refreshing token:', error);
                return false;
            }
        }

        async function refreshAllTokens() {
            const refreshBtn = document.querySelector('.refresh-btn');
            const originalText = refreshBtn.textContent;
            
            try {
                refreshBtn.innerHTML = '🔄 Refreshing...';
                refreshBtn.disabled = true;
                
                showMessage('Refreshing all token information...', 'info');
                
                let successCount = 0;
                for (const token of savedTokens) {
                    const success = await refreshTokenInfo(token.address);
                    if (success) successCount++;
                }
                
                showMessage(`Refreshed ${successCount}/${savedTokens.length} tokens successfully!`, 'success');
                
            } catch (error) {
                console.error('Error refreshing tokens:', error);
                showMessage('Failed to refresh some tokens', 'error');
            } finally {
                refreshBtn.textContent = originalText;
                refreshBtn.disabled = false;
            }
        }

        function updateSavedTokensList() {
            const container = document.getElementById('savedTokensList');
            
            if (savedTokens.length === 0) {
                container.innerHTML = `
                    <div class="no-tokens">
                        <p>No tokens saved yet. Deploy a new token or load an existing one to get started.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = savedTokens.map(token => `
                <div class="saved-token-card">
                    <div class="token-info">
                        <div class="token-name">${token.name} (${token.symbol})</div>
                        <div class="token-address">${token.address.slice(0, 10)}...${token.address.slice(-8)}</div>
                    </div>
                    
                    <div style="margin-top: 10px; font-size: 14px;">
                        <div><strong>Your Balance:</strong> ${parseFloat(token.userBalance || 0).toLocaleString()}</div>
                        <div><strong>Total Supply:</strong> ${parseFloat(token.totalSupply || 0).toLocaleString()}</div>
                        <div><strong>Minter Role:</strong> ${token.hasMinterRole ? '✅ Yes' : '❌ No'}</div>
                        <div><strong>Last Updated:</strong> ${new Date(token.lastUpdated).toLocaleString()}</div>
                    </div>
                    
                    <div class="token-actions">
                        <button class="token-action-btn primary" onclick="useTokenForMinting('${token.address}')">
                            Mint
                        </button>
                        <button class="token-action-btn primary" onclick="useTokenForRoles('${token.address}')">
                            Roles
                        </button>
                        <button class="token-action-btn primary" onclick="useTokenForTransfer('${token.address}')">
                            Transfer
                        </button>
                        <button class="token-action-btn secondary" onclick="loadTokenQuick('${token.address}')">
                            Details
                        </button>
                        <button class="token-action-btn secondary" onclick="refreshTokenInfo('${token.address}')">
                            Refresh
                        </button>
                        <button class="token-action-btn danger" onclick="removeToken('${token.address}')">
                            Remove
                        </button>
                    </div>
                </div>
            `).join('');
        }

        async function importExistingToken(event) {
            event.preventDefault();
            
            const address = document.getElementById('importTokenAddress').value;
            
            if (!address) {
                showMessage('Please enter a token address', 'error');
                return;
            }
            
            try {
                showMessage('Loading token information...', 'info');
                
                const contract = new ethers.Contract(address, TOKEN_ABI, signer);
                
                const [name, symbol, decimals, totalSupply] = await Promise.all([
                    contract.name(),
                    contract.symbol(),
                    contract.decimals(),
                    contract.totalSupply()
                ]);
                
                const userBalance = await contract.balanceOf(userAddress);
                const hasMinterRole = await contract.hasRole(MINTER_ROLE, userAddress);
                
                const tokenInfo = {
                    address: address,
                    name: name,
                    symbol: symbol,
                    decimals: decimals,
                    totalSupply: ethers.utils.formatUnits(totalSupply, decimals),
                    userBalance: ethers.utils.formatUnits(userBalance, decimals),
                    hasMinterRole: hasMinterRole,
                    savedAt: new Date().toISOString(),
                    lastUpdated: new Date().toISOString()
                };
                
                if (addTokenToSaved(tokenInfo)) {
                    document.getElementById('importForm').reset();
                    showTab('manage');
                }
                
            } catch (error) {
                console.error('Import error:', error);
                showMessage('Failed to import token: ' + error.message, 'error');
            }
        }

        async function deployToken(event) {
            event.preventDefault();
            
            const deployBtn = document.getElementById('deployBtn');
            const originalText = deployBtn.textContent;
            
            try {
                deployBtn.innerHTML = '<div class="loading"></div> Deploying...';
                deployBtn.disabled = true;
                
                const name = document.getElementById('tokenName').value;
                const symbol = document.getElementById('tokenSymbol').value;
                const initialMint = document.getElementById('initialMint').value;
                
                showMessage('Deploying token contract...', 'info');
                
                // Create contract factory
                const factory = new ethers.ContractFactory(TOKEN_ABI, TOKEN_BYTECODE, signer);
                
                // Deploy contract
                const contract = await factory.deploy(name, symbol);
                await contract.deployed();
                
                showMessage(`Token deployed successfully! Address: ${contract.address}`, 'success');
                
                // Save token information
                const tokenInfo = {
                    address: contract.address,
                    name: name,
                    symbol: symbol,
                    decimals: 18, // Default for most tokens
                    totalSupply: "0",
                    userBalance: "0",
                    hasMinterRole: true, // Deployer gets minter role
                    deployedAt: new Date().toISOString(),
                    savedAt: new Date().toISOString(),
                    lastUpdated: new Date().toISOString()
                };
                
                addTokenToSaved(tokenInfo);
                
                // Initial mint if specified
                if (initialMint && parseFloat(initialMint) > 0) {
                    showMessage('Minting initial tokens...', 'info');
                    await contract.mint(userAddress, ethers.utils.parseEther(initialMint));
                    
                    // Update token info with minted amount
                    tokenInfo.totalSupply = initialMint;
                    tokenInfo.userBalance = initialMint;
                    updateTokenInfo(contract.address, tokenInfo);
                    
                    showMessage(`Minted ${initialMint} tokens to your address`, 'success');
                }
                
                // Reset form and show manage tab
                document.getElementById('deployForm').reset();
                showTab('manage');
                
            } catch (error) {
                console.error('Deployment error:', error);
                showMessage('Deployment failed: ' + error.message, 'error');
            } finally {
                deployBtn.textContent = originalText;
                deployBtn.disabled = false;
            }
        }

        async function mintTokens(event) {
            event.preventDefault();
            
            const mintBtn = document.getElementById('mintBtn');
            const originalText = mintBtn.textContent;
            
            try {
                mintBtn.innerHTML = '<div class="loading"></div> Minting...';
                mintBtn.disabled = true;
                
                const tokenAddress = document.getElementById('mintTokenAddress').value;
                const recipient = document.getElementById('mintRecipient').value;
                const amount = document.getElementById('mintAmount').value;
                
                const contract = new ethers.Contract(tokenAddress, TOKEN_ABI, signer);
                const decimals = await contract.decimals();
                const mintAmount = ethers.utils.parseUnits(amount, decimals);
                
                const tx = await contract.mint(recipient, mintAmount);
                showMessage('Transaction submitted. Waiting for confirmation...', 'info');
                
                const receipt = await tx.wait();
                showMessage(`Successfully minted ${amount} tokens! Tx: ${receipt.transactionHash}`, 'success');
                
                // Refresh token info if it's in saved tokens
                refreshTokenInfo(tokenAddress);
                
                document.getElementById('mintForm').reset();
                document.getElementById('mintRecipient').value = userAddress; // Reset to user address
                
            } catch (error) {
                console.error('Minting error:', error);
                showMessage('Minting failed: ' + error.message, 'error');
            } finally {
                mintBtn.textContent = originalText;
                mintBtn.disabled = false;
            }
        }

        async function grantMinterRole() {
            const tokenAddress = document.getElementById('rolesTokenAddress').value;
            const account = document.getElementById('roleAccount').value;
            
            if (!tokenAddress || !account) {
                showMessage('Please fill in all fields', 'error');
                return;
            }
            
            try {
                const contract = new ethers.Contract(tokenAddress, TOKEN_ABI, signer);
                const tx = await contract.grantRole(MINTER_ROLE, account);
                
                showMessage('Transaction submitted. Waiting for confirmation...', 'info');
                const receipt = await tx.wait();
                showMessage(`Minter role granted successfully! Tx: ${receipt.transactionHash}`, 'success');
                
                // Refresh token info if it's in saved tokens
                refreshTokenInfo(tokenAddress);
                
            } catch (error) {
                console.error('Grant role error:', error);
                showMessage('Failed to grant role: ' + error.message, 'error');
            }
        }

        async function revokeMinterRole() {
            const tokenAddress = document.getElementById('rolesTokenAddress').value;
            const account = document.getElementById('roleAccount').value;
            
            if (!tokenAddress || !account) {
                showMessage('Please fill in all fields', 'error');
                return;
            }
            
            try {
                const contract = new ethers.Contract(tokenAddress, TOKEN_ABI, signer);
                const tx = await contract.revokeRole(MINTER_ROLE, account);
                
                showMessage('Transaction submitted. Waiting for confirmation...', 'info');
                const receipt = await tx.wait();
                showMessage(`Minter role revoked successfully! Tx: ${receipt.transactionHash}`, 'success');
                
                // Refresh token info if it's in saved tokens
                refreshTokenInfo(tokenAddress);
                
            } catch (error) {
                console.error('Revoke role error:', error);
                showMessage('Failed to revoke role: ' + error.message, 'error');
            }
        }

        async function setMetadata(event) {
            event.preventDefault();
            
            const metadataBtn = document.getElementById('metadataBtn');
            const originalText = metadataBtn.textContent;
            
            try {
                metadataBtn.innerHTML = '<div class="loading"></div> Setting...';
                metadataBtn.disabled = true;
                
                const tokenAddress = document.getElementById('metadataTokenAddress').value;
                const registryAddress = document.getElementById('metadataRegistryAddress').value;
                const metadataURI = document.getElementById('metadataURI').value;
                
                const contract = new ethers.Contract(registryAddress, REGISTRY_ABI, signer);
                const tx = await contract.setMetadata(tokenAddress, metadataURI);
                
                showMessage('Transaction submitted. Waiting for confirmation...', 'info');
                const receipt = await tx.wait();
                showMessage(`Metadata set successfully! Tx: ${receipt.transactionHash}`, 'success');
                
                document.getElementById('metadataForm').reset();
                
            } catch (error) {
                console.error('Set metadata error:', error);
                showMessage('Failed to set metadata: ' + error.message, 'error');
            } finally {
                metadataBtn.textContent = originalText;
                metadataBtn.disabled = false;
            }
        }

        async function transferTokens(event) {
            event.preventDefault();
            
            const transferBtn = document.getElementById('transferBtn');
            const originalText = transferBtn.textContent;
            
            try {
                transferBtn.innerHTML = '<div class="loading"></div> Transferring...';
                transferBtn.disabled = true;
                
                const tokenAddress = document.getElementById('transferTokenAddress').value;
                const recipient = document.getElementById('transferRecipient').value;
                const amount = document.getElementById('transferAmount').value;
                
                const contract = new ethers.Contract(tokenAddress, TOKEN_ABI, signer);
                const decimals = await contract.decimals();
                const transferAmount = ethers.utils.parseUnits(amount, decimals);
                
                const tx = await contract.transfer(recipient, transferAmount);
                showMessage('Transaction submitted. Waiting for confirmation...', 'info');
                
                const receipt = await tx.wait();
                showMessage(`Successfully transferred ${amount} tokens! Tx: ${receipt.transactionHash}`, 'success');
                
                // Refresh token info if it's in saved tokens
                refreshTokenInfo(tokenAddress);
                
                document.getElementById('transferForm').reset();
                
            } catch (error) {
                console.error('Transfer error:', error);
                showMessage('Transfer failed: ' + error.message, 'error');
            } finally {
                transferBtn.textContent = originalText;
                transferBtn.disabled = false;
            }
        }

        async function loadExistingToken(event) {
            event.preventDefault();
            
            try {
                const tokenAddress = document.getElementById('existingTokenAddress').value;
                const contract = new ethers.Contract(tokenAddress, TOKEN_ABI, signer);
                
                // Get token details
                const [name, symbol, decimals, totalSupply] = await Promise.all([
                    contract.name(),
                    contract.symbol(),
                    contract.decimals(),
                    contract.totalSupply()
                ]);
                
                const userBalance = await contract.balanceOf(userAddress);
                const hasMinterRole = await contract.hasRole(MINTER_ROLE, userAddress);
                
                currentTokenInfo = {
                    address: tokenAddress,
                    name: name,
                    symbol: symbol,
                    decimals: decimals,
                    totalSupply: ethers.utils.formatUnits(totalSupply, decimals),
                    userBalance: ethers.utils.formatUnits(userBalance, decimals),
                    hasMinterRole: hasMinterRole
                };
                
                displayTokenInfo(currentTokenInfo);
                showMessage('Token loaded successfully!', 'success');
                
            } catch (error) {
                console.error('Load token error:', error);
                showMessage('Failed to load token: ' + error.message, 'error');
            }
        }

        function displayTokenInfo(tokenInfo) {
            const tokenDetails = document.getElementById('tokenDetails');
            tokenDetails.innerHTML = `
                <div class="token-item">
                    <div class="token-info">
                        <div class="token-name">${tokenInfo.name} (${tokenInfo.symbol})</div>
                        <div class="token-address">${tokenInfo.address}</div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div>
                            <strong>Decimals:</strong> ${tokenInfo.decimals}
                        </div>
                        <div>
                            <strong>Total Supply:</strong> ${parseFloat(tokenInfo.totalSupply).toLocaleString()}
                        </div>
                        <div>
                            <strong>Your Balance:</strong> ${parseFloat(tokenInfo.userBalance).toLocaleString()}
                        </div>
                        <div>
                            <strong>Minter Role:</strong> ${tokenInfo.hasMinterRole ? '✅ Yes' : '❌ No'}
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('tokenInfo').style.display = 'block';
        }

        function saveCurrentToken() {
            if (!currentTokenInfo) {
                showMessage('No token loaded to save', 'error');
                return;
            }
            
            addTokenToSaved(currentTokenInfo);
        }

        function useTokenForMinting(tokenAddress = null) {
            const address = tokenAddress || (currentTokenInfo ? currentTokenInfo.address : '');
            if (!address) return;
            
            document.getElementById('mintTokenAddress').value = address;
            showTab('mint');
            showMessage('Token address loaded for minting!', 'info');
        }

        function useTokenForRoles(tokenAddress = null) {
            const address = tokenAddress || (currentTokenInfo ? currentTokenInfo.address : '');
            if (!address) return;
            
            document.getElementById('rolesTokenAddress').value = address;
            showTab('roles');
            showMessage('Token address loaded for role management!', 'info');
        }

        function useTokenForTransfer(tokenAddress = null) {
            const address = tokenAddress || (currentTokenInfo ? currentTokenInfo.address : '');
            if (!address) return;
            
            document.getElementById('transferTokenAddress').value = address;
            showTab('transfer');
            showMessage('Token address loaded for transfers!', 'info');
        }

        async function loadTokenQuick(address) {
            try {
                const contract = new ethers.Contract(address, TOKEN_ABI, signer);
                
                const [name, symbol, decimals, totalSupply] = await Promise.all([
                    contract.name(),
                    contract.symbol(),
                    contract.decimals(),
                    contract.totalSupply()
                ]);
                
                const userBalance = await contract.balanceOf(userAddress);
                const hasMinterRole = await contract.hasRole(MINTER_ROLE, userAddress);
                
                const tokenInfo = {
                    address: address,
                    name: name,
                    symbol: symbol,
                    decimals: decimals,
                    totalSupply: ethers.utils.formatUnits(totalSupply, decimals),
                    userBalance: ethers.utils.formatUnits(userBalance, decimals),
                    hasMinterRole: hasMinterRole
                };
                
                // Load in existing tokens tab
                document.getElementById('existingTokenAddress').value = address;
                currentTokenInfo = tokenInfo;
                displayTokenInfo(tokenInfo);
                showTab('existing');
                showMessage('Token loaded successfully!', 'success');
                
            } catch (error) {
                console.error('Load token error:', error);
                showMessage('Failed to load token: ' + error.message, 'error');
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showMessage('Address copied to clipboard!', 'success');
            });
        }

        function showMessage(message, type) {
            const container = document.getElementById('statusMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `status-message status-${type}`;
            messageDiv.textContent = message;
            
            container.appendChild(messageDiv);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.parentNode.removeChild(messageDiv);
                }
            }, 5000);
            
            // Scroll to message
            messageDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Listen for account changes
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length === 0) {
                    // User disconnected
                    location.reload();
                } else {
                    // User switched accounts
                    initializeWallet();
                }
            });

            window.ethereum.on('chainChanged', (chainId) => {
                // User switched networks
                location.reload();
            });
        }

        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case '1':
                        e.preventDefault();
                        showTab('deploy');
                        break;
                    case '2':
                        e.preventDefault();
                        showTab('mint');
                        break;
                    case '3':
                        e.preventDefault();
                        showTab('roles');
                        break;
                    case '4':
                        e.preventDefault();
                        showTab('metadata');
                        break;
                    case '5':
                        e.preventDefault();
                        showTab('transfer');
                        break;
                    case '6':
                        e.preventDefault();
                        showTab('existing');
                        break;
                    case '7':
                        e.preventDefault();
                        showTab('manage');
                        break;
                }
            }
        });
    </script>
</body>
</html>